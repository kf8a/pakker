defmodule PakkerFrameTest do
  use ExUnit.Case

  test "it removes SerSync bytes" do
    # ring packet from 4094 to pakbus address 1 "BD 90 01 0F FE 71 D2 BD"
    bits = << 0xbd, 0xbd, 0xbd, 0xbd, 0x90, 0x01, 0x0f, 0xfe, 0x71, 0xd2, 0xbd >>
    packet = Pakker.Frame.from_bits(bits)
    assert packet == << 0x90, 0x01, 0x0f, 0xfe, 0x71, 0xd2 >>
  end

  test "it unquotes SerSync and quote bytes" do
    bits = << 0x90,  0xbc, 0xdd, 0x01, 0x0f, 0xfe, 0x71, 0xbc, 0xdc, 0xd2 >>
    packet = Pakker.Frame.unquote_message(bits)
    assert packet == << 0x90, 0xbd, 0x01, 0x0f, 0xfe, 0x71, 0xbc, 0xd2 >>
  end

  test 'quotes SerSync and quote bytes' do
    message = << 0x90, 0xbd, 0x01, 0x0f, 0xfe, 0x71, 0xbc, 0xd2 >>
    packet = Pakker.Frame.quote_message(message)
    assert packet == << 0x90,  0xbc, 0xdd, 0x01, 0x0f, 0xfe, 0x71, 0xbc, 0xdc, 0xd2 >>
  end

  test 'add SerSync bytes' do
    message = << 0x90, 0xbd, 0x01 >>
    packet = Pakker.Frame.to_bits(message)
    assert packet == << 0xbd, 0x90, 0xbd, 0x01, 0xbd >>
  end
end
